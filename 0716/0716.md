# 4.1 資料預處理
資料預處理是機器學習流程中的重要步驟，透過不同的預處理策略可以將原始的數據轉換成更適合進行分析的格式。在本研究中，我們主要採用四種預處理方法，包括靜態校正、卡爾曼濾波器、正規化以及降採樣。

## 4.1.1 靜態校正
在數據處理過程中，靜態校正是用於消除傳感器固有的系統誤差。這些誤差通常在製造過程中形成，並在整個傳感器壽命中保持不變。通過減少這些誤差，我們可以得到更準確的傳感器讀數。

## 4.1.2 卡爾曼濾波器
卡爾曼濾波器是一種優化技術，用於消除測量數據中的隨機噪聲。這種技術特別適用於含有不確定性或誤差的數據。透過卡爾曼濾波器，我們可以提高數據的準確性和一致性，從而得到更好的機器學習結果。

## 4.1.3 正規化
正規化是一種將數據轉換成具有一致範數的處理方法。這種方法可以消除數據範疇間的不一致性，從而使得不同的特徵能在同一的比例尺度下進行比較。在本研究中，我們使用正規化以確保所有的特徵在模型訓練過程中具有相同的重要性。

## 4.1.4 降採樣
降採樣是一種將數據的採樣頻率降低的方法，其主要目的是減少數據量和計算負荷。在本研究中，我們採用降採樣以減少對計算資源的需求，同時也可以避免在數據過度密集的情況下出現的過擬合現象。

## 4.1.5 預處理消融實驗
為了探討各種預處理策略對最終結果的影響，我們設計了一系列的消融實驗。在每個消融實驗中，我們分別省略了一種或多種預處理策略，並觀察其對最終結果的影響。透過這種方式，我們可以更好地理解各種預處理策略的重要性，並對其優化程度有更清晰的認識。

這種消融實驗的設計方法是：我們將每個預處理策略作為一個"成分"，然後分別對每個成分進行添加或移除，從而創建出多種不同的數據處理方案。每一種方案都對應一種特定的預處理流程，並將其結果與其他方案進行比較。透過這種方法，我們可以明確地看到每一種預處理策略對結果的影響，並對其進行量化評估。



### Case 1: 降採樣 (Downsampling)
### 文件名: Baseline_Downsample_F6.csv
### 分群模型檔: case1_20230715_model_220148.pkl  (為了可重置實驗)

在這個基準案例中，我們將原始數據經過降採樣處理，將數據的採樣頻率降低。這是最基本的預處理步驟，它的主要目的是降低數據的複雜性和規模，使得後續的分析更易於處理。這也為我們提供了一個基準，可以用來評估其他更複雜的預處理策略的效果。


| RideTrack      |    Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|--------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 67.0225 |       19.2982 |      32.7511 |    46.25 |     35.5932 |          61.7486 |            54.499  |
| Filter_Predict | 82.0878 |       24.5614 |      35.8079 |    52.5  |     41.5254 |          69.3989 |            65.0925 |


| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       28 |                32 |                      7 |                      19 |                          10 |                  18 |    24.5614 |
| Idle           |                        0 |               692 |                      0 |                      50 |                         101 |                   0 |    82.0878 |
| Turn Left      |                       39 |                 9 |                     49 |                      10 |                           9 |                   2 |    41.5254 |
| Turn Right     |                       39 |                67 |                     13 |                      82 |                          13 |                  15 |    35.8079 |
| Two-Stage Left |                        0 |                39 |                     11 |                       6 |                         127 |                   0 |    69.3989 |
| U-turn         |                        0 |                 8 |                      0 |                      13 |                          17 |                  42 |    52.5    |





### Case 2: 正規化+降採樣
### 文件名: Normalization_Downsample_F6.csv
### 分群模型檔: case2_20230715_model_221139.pkl  (為了可重置實驗)

在第二個案例中，我們在降採樣的基礎上加入了正規化步驟。正規化是一種常見的數據預處理方法，它的主要目的是消除數據中的量級差異，使得所有的數據都在同一個量級上，這樣可以避免模型被某些數據的量級差異所影響。



| RideTrack      |    Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|--------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 87.1886 |       16.6667 |      40.6114 |     50   |     47.4576 |          56.8306 |            66.8156 |
| Filter_Predict | 93.8316 |       19.2982 |      39.3013 |     67.5 |     60.1695 |          67.2131 |            73.4525 |



| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       22 |                56 |                      0 |                      16 |                           9 |                  11 |    19.2982 |
| Idle           |                        0 |               791 |                      0 |                      13 |                          39 |                   0 |    93.8316 |
| Turn Left      |                       13 |                 0 |                     71 |                      19 |                           4 |                  11 |    60.1695 |
| Turn Right     |                       18 |                36 |                     51 |                      90 |                          19 |                  15 |    39.3013 |
| Two-Stage Left |                        4 |                49 |                      0 |                       7 |                         123 |                   0 |    67.2131 |
| U-turn         |                        0 |                11 |                      0 |                       0 |                          15 |                  54 |    67.5    |









### Case 3: 靜態校正+正規化+降採樣
### 文件名: Correction_Normalization_Downsample_F6.csv
### 分群模型檔: case3_20230715_model_222229.pkl (為了可重置實驗)


在第三個案例中，我們在正規化和降採樣的基礎上進行了靜態校正。靜態校正的目的是糾正數據中可能存在的靜態偏差，例如由於儀器的校準問題等引起的偏差。


| RideTrack      |    Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|--------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 86.121  |       28.0702 |      45.4148 |    46.25 |     32.2034 |          62.8415 |            67.1347 |
| Filter_Predict | 90.1542 |       35.0877 |      51.5284 |    47.5  |     30.5085 |          79.7814 |            72.6228 |


| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       40 |                51 |                      0 |                      18 |                           5 |                   0 |    35.0877 |
| Idle           |                        0 |               760 |                      0 |                       7 |                          76 |                   0 |    90.1542 |
| Turn Left      |                       25 |                 1 |                     36 |                      37 |                          13 |                   6 |    30.5085 |
| Turn Right     |                       18 |                38 |                     29 |                     118 |                          26 |                   0 |    51.5284 |
| Two-Stage Left |                        6 |                31 |                      0 |                       0 |                         146 |                   0 |    79.7814 |
| U-turn         |                        0 |                10 |                      0 |                       0 |                          32 | 





### Case 4: 卡爾曼濾波器+正規化+降採樣
### 文件名: Kalman_Normalization_Downsample_F6.csv
### 分群模型檔: case4_20230715_model_222837.pkl (為了可重置實驗)

在第四個案例中，我們引入了卡爾曼濾波器進行數據處理。卡爾曼濾波器是一種優秀的時間序列數據處理工具，能夠有效地處理數據中的雜訊並提取出數據的真實變化趨勢。


| RideTrack      |    Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|--------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 98.8138 |       61.4035 |      55.4585 |       80 |     78.8136 |          71.5847 |            84.1098 |
| Filter_Predict | 98.8138 |       69.2982 |      64.1921 |       80 |     73.7288 |          80.8743 |            86.6624 |


| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       79 |                19 |                      8 |                       0 |                           5 |                   3 |    69.2982 |
| Idle           |                        0 |               833 |                      0 |                       0 |                          10 |                   0 |    98.8138 |
| Turn Left      |                        1 |                 0 |                     87 |                       4 |                           0 |                  26 |    73.7288 |
| Turn Right     |                       41 |                 4 |                     36 |                     147 |                           1 |                   0 |    64.1921 |
| Two-Stage Left |                       16 |                14 |                      0 |                       5 |                         148 |                   0 |    80.8743 |
| U-turn         |                        0 |                12 |                      0 |                       4 |                           0 |                  64 |    80      |





### Case 5: 靜態校正+卡爾曼濾波器+正規化+降採樣
### 文件名: Correction_Kalman_Normalization_Downsample_F6.csv
### 分群模型檔: case5_20230715_model_223826.pkl (為了可重置實驗)

在第五個案例中，我們將所有的預處理步驟都結合起來，包括靜態校正、卡爾曼濾波器、正規化和降採樣。這種組合允許我們看到當所有的預處理步驟都使用時，對最終結果的影響。


| RideTrack      |    Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|--------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 96.6785 |       50.8772 |      50.655  |    83.75 |     60.1695 |          76.5027 |            80.8551 |
| Filter_Predict | 98.9324 |       59.6491 |      58.0786 |    86.25 |     56.7797 |          85.2459 |            84.6841 |





| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       68 |                 2 |                     12 |                       5 |                          16 |                  11 |    59.6491 |
| Idle           |                        0 |               834 |                      0 |                       0 |                           9 |                   0 |    98.9324 |
| Turn Left      |                       30 |                 1 |                     67 |                       4 |                           9 |                   7 |    56.7797 |
| Turn Right     |                        4 |                43 |                     37 |                     133 |                          12 |                   0 |    58.0786 |
| Two-Stage Left |                        0 |                 9 |                      0 |                      18 |                         156 |                   0 |    85.2459 |
| U-turn         |                        0 |                 7 |                      0 |                       4 |                           0 |                  69 |    86.25   |



### Case 6: 靜態校正+正規化+卡爾曼濾波器+降採樣
### 文件名: Correction_Normalization_Kalman_Downsample_F6.csv
### 分群模型檔: case6_20230715_model_224538.pkl (為了可重置實驗)

在第六個案例中，我們改變了預處理步驟的順序。這個案例的目的是探討預處理步驟的順序對最終結果的影響。


| RideTrack      |    Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|--------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 99.7628 |       54.386  |      66.3755 |    81.25 |     94.9153 |          66.1202 |            86.3433 |
| Filter_Predict | 99.7628 |       57.0175 |      73.7991 |    81.25 |     97.4576 |          78.1421 |            89.2151 |



| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       65 |                28 |                      0 |                       0 |                          21 |                   0 |    57.0175 |
| Idle           |                        0 |               841 |                      0 |                       0 |                           2 |                   0 |    99.7628 |
| Turn Left      |                        0 |                 0 |                    115 |                       3 |                           0 |                   0 |    97.4576 |
| Turn Right     |                       26 |                12 |                      0 |                     169 |                          15 |                   7 |    73.7991 |
| Two-Stage Left |                        8 |                17 |                      0 |                      15 |                         143 |                   0 |    78.1421 |
| U-turn         |                        0 |                11 |                      0 |                       4 |                           0 |                  65 |    81.25   |


#### 透過這六種不同的數據處理方案，我們能夠深入理解每個預處理步驟對最終結果的影響，這對於優化數據處理流程，提高最終分析結果的準確性和可靠性具有關鍵的指導意義。在沒有真實的分群標籤的情況下，我們將分群完的結果拿去訓練變量長度馬可夫模型(VLMM)，以模型的預測準確度來評價分群的效果。






# 4.2 特徵工程與主成分分析(PCA)
特徵工程與主成分分析（PCA）在我們的機車儀器測量單元 (IMU) 和引擎控制單元 (ECU) 數據分析中扮演了重要的角色。在這一章節中，我們會詳細介紹我們如何透過這兩種技術，挑選出對模型最具影響力的特徵，以及如何透過PCA降低數據維度以優化我們的模型表現。

## 4.2.1 特徵工程和主成分分析 (PCA)
特徵工程的目標是找出最具代表性的數據特徵，並根據這些特徵來訓練我們的機器學習模型。這可能涉及到特徵的挑選，或者透過降維技術，如PCA，來降低數據的複雜度。

PCA是一種常用的降維技術，它尋找一組新的特徵，這些特徵是原始數據特徵的線性組合，並且這些新的特徵，即主成分，能夠最大化數據的方差。在我們的應用中，我們透過觀察解釋方差比來確定需要保留多少主成分。在大多數情況下，我們希望至少保留95%的方差，以確保在降低數據複雜度的同時，仍然保留大部分的數據信息。

每個主成分都是原始特徵的線性組合，並且每個原始特徵在這個線性組合中的權重代表了該特徵在該主成分中的重要性。我們可以透過將每個原始特徵在所有主成分中的權重加總，來獲得該特徵的總權重，從而評估該特徵的重要性。

## 4.2.2 特徵工程消融實驗 (IMU)
為了更好地理解我們的特徵選擇和降維策略對模型性能的影響，我們對IMU數據進行了以下消融實驗：

### Case 1：僅使用IMU的9個特徵：這是我們的基線實驗，我們將在這個基線的基礎上進行比較。我們使用預處理後的IMU數據，不進行任何特徵選擇或降維操作。

#### 經過預處理消融實驗以 Case 6 效能最佳當作 baseline


### Case 2：使用IMU並通過PCA降至k個特徵：在這個實驗中，我們對IMU數據進行PCA，並選擇前k個主成分作為我們的特徵。我們將比較不同的k值對模型性能的影響，並試圖找到一個平衡點，在保留足夠的數據信息的同時，減少數據的維度和模型的複雜度。
### 分群模型檔: Ablation2_Case2_PCA_Model.pkl (為了可重置實驗)


| RideTrack      |     Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|---------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 0.118624 |       71.9298 |            0 |        0 |     25.4237 |                0 |            7.21123 |
| Filter_Predict | 0        |       71.9298 |            0 |        0 |     25.4237 |                0 |            7.14742 |



| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       82 |                 0 |                     32 |                       0 |                           0 |                   0 |    71.9298 |
| Idle           |                      655 |                 0 |                    117 |                       0 |                          71 |                   0 |     0      |
| Turn Left      |                       65 |                23 |                     30 |                       0 |                           0 |                   0 |    25.4237 |
| Turn Right     |                      149 |                41 |                     39 |                       0 |                           0 |                   0 |     0      |
| Two-Stage Left |                      122 |                 0 |                     61 |                       0 |                           0 |                   0 |     0      |
| U-turn         |                       37 |                 0 |                     20 |                       0 |                          23 |                   0 |     0      | 


### Case 3：僅使用IMU中最重要的k個特徵：在這個實驗中，我們將只使用最重要的k個特徵來訓練我們的模型。我們會使用PCA的結果來評估特徵的重要性，並選擇權重最大的k個特徵。另外，我們也會使用隨機森林的特徵重要性作為一個比較，看看兩種方法是否有一致的結果。

#### Case 3-1：PCA的來評估特徵的重要性，並選擇權重最大的k個特徵
#### 分群模型檔: Ablation2_Case3_PCA_Model.pkl (為了可重置實驗)
#### 選擇特徵: Z-axis Angular Velocity、Z-axis Angle、X-axis Angular Velocity、Y-axis Angle 、X-axis Acceleration、X-axis Angle    
| Feature                 |    Weight |
|:------------------------|----------:|
| Z-axis Angular Velocity | 0.366453  |
| Z-axis Angle            | 0.351774  |
| X-axis Angular Velocity | 0.345129  |
| Y-axis Angle            | 0.329057  |
| X-axis Acceleration     | 0.23259   |
| X-axis Angle            | 0.177267  |
| Y-axis Acceleration     | 0.150164  |
| Y-axis Angular Velocity | 0.0639817 |
| Z-axis Acceleration     | 0.0243168 |



| RideTrack      |     Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|---------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 0.118624 |       71.9298 |            0 |        0 |     25.4237 |                0 |            7.21123 |
| Filter_Predict | 0        |       71.9298 |            0 |        0 |     25.4237 |                0 |            7.14742 |



| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       82 |                 0 |                     32 |                       0 |                           0 |                   0 |    71.9298 |
| Idle           |                      655 |                 0 |                    117 |                       0 |                          71 |                   0 |     0      |
| Turn Left      |                       65 |                23 |                     30 |                       0 |                           0 |                   0 |    25.4237 |
| Turn Right     |                      149 |                41 |                     39 |                       0 |                           0 |                   0 |     0      |
| Two-Stage Left |                      122 |                 0 |                     61 |                       0 |                           0 |                   0 |     0      |
| U-turn         |                       37 |                 0 |                     20 |                       0 |                          23 |                   0 |     0      | 




#### Case 3-2：隨機森林選擇權重最大的k個特徵
#### 分群模型檔: Ablation2_Case3_RandomForestClassifier_Model.pkl (為了可重置實驗)
#### 選擇特徵: X-axis Angular Velocity、Z-axis Angular Velocity、X-axis Acceleration、X-axis Angle、Y-axis Angle、X-axis Angle

|        X-axis Angular Velocity |        Y-axis Angular Velocity |       Z-axis Angular Velocity |         X-axis Acceleration |         Y-axis Acceleration |         Z-axis Acceleration |        X-axis Angle |         Y-axis Angle |         Z-axis Angle |
|---------:|---------:|--------:|----------:|----------:|----------:|---------:|----------:|----------:|
| 0.106372 | 0.106093 | 0.32063 | 0.0906667 | 0.0372189 | 0.0463522 | 0.163035 | 0.0852189 | 0.0444122 | 

| RideTrack      |    Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|--------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 99.6441 |       60.5263 |      76.8559 |       80 |     82.2034 |          65.5738 |            87.1729 |
| Filter_Predict | 99.8814 |       61.4035 |      82.9694 |       90 |     94.9153 |          72.6776 |            90.5552 |



| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       70 |                21 |                      0 |                       0 |                          23 |                   0 |    61.4035 |
| Idle           |                        0 |               842 |                      0 |                       0 |                           1 |                   0 |    99.8814 |
| Turn Left      |                        0 |                 0 |                    112 |                       0 |                           0 |                   6 |    94.9153 |
| Turn Right     |                       30 |                 0 |                      0 |                     190 |                           9 |                   0 |    82.9694 |
| Two-Stage Left |                       23 |                22 |                      1 |                       0 |                         133 |                   4 |    72.6776 |
| U-turn         |                        0 |                 7 |                      0 |                       1 |                           0 |                  72 |    90      |

### Case 4：使用IMU並通過PCA降至3個特徵：在這個實驗中，我們再次使用PCA，但是這次我們只保留前3個主成分。我們將這個結果與Case 2進行比較，看看進一步降低數據維度是否會對模型性能產生顯著影響。

以上的實驗設計讓我們可以全面地理解特徵選擇和降維策略對模型性能的影響，並幫助我們優化我們的特徵工程策略。

#### 分群模型檔: Ablation2_Case4_PCA_Model.pkl (為了可重置實驗)



| RideTrack      |     Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|---------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 0.118624 |       46.4912 |            0 |        0 |     21.1864 |          13.6612 |            6.63689 |
| Filter_Predict | 0        |       46.4912 |            0 |        0 |     21.1864 |          13.6612 |            6.57307 |


| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       53 |                 0 |                     32 |                       0 |                          29 |                   0 |    46.4912 |
| Idle           |                      384 |                 0 |                    117 |                       0 |                         342 |                   0 |     0      |
| Turn Left      |                       41 |                43 |                     25 |                       6 |                           3 |                   0 |    21.1864 |
| Turn Right     |                       98 |                41 |                     39 |                       0 |                          51 |                   0 |     0      |
| Two-Stage Left |                       97 |                 0 |                     61 |                       0 |                          25 |                   0 |    13.6612 |
| U-turn         |                       18 |                 0 |                     20 |                       0 |                          42 |                   0 |     0      |




### Case 5：IMU中最重要的3個特徵：在這個實驗中，在這個實驗中，我們將只使用最重要的3個特徵來訓練我們的模型。我們會使用PCA的結果來評估特徵的重要性，並選擇權重最大的3個特徵。另外，我們也會使用隨機森林的特徵重要性作為一個比較，以及只使用x, y, z角速度，看看三種方法是否有一致的結果。

以上的實驗設計讓我們可以全面地理解特徵選擇和降維策略對模型性能的影響，並幫助我們優化我們的特徵工程策略。




#### Case 5-1：只使用x, y, z角速度
#### 分群模型檔: Ablation2_Case5_Angular_Velocity_Model.pkl (為了可重置實驗)
#### 選擇特徵:X-axis Angular Velocity、Y-axis Angular Velocity、Z-axis Angular Velocity

| RideTrack      |    Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|--------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 99.8814 |       22.807  |      92.1397 |    68.75 |     99.1525 |          53.5519 |            86.0881 |
| Filter_Predict | 99.8814 |       26.3158 |      93.0131 |    86.25 |    100      |          65.5738 |            88.8322 |


| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       30 |                74 |                      0 |                       0 |                          10 |                   0 |    26.3158 |
| Idle           |                        0 |               842 |                      0 |                       0 |                           1 |                   0 |    99.8814 |
| Turn Left      |                        0 |                 0 |                    118 |                       0 |                           0 |                   0 |   100      |
| Turn Right     |                        9 |                 6 |                      0 |                     213 |                           1 |                   0 |    93.0131 |
| Two-Stage Left |                       12 |                36 |                      0 |                      15 |                         120 |                   0 |    65.5738 |
| U-turn         |                        0 |                 3 |                      0 |                       2 |                           6 |                  69 |    86.25   |



#### Case 5-2：PCA的來評估特徵的重要性，並選擇權重最大的k個特徵
#### 分群模型檔: Ablation2_Case5_PCA_Model.pkl (為了可重置實驗)
#### 選擇特徵: X-axis Angular Velocity、Z-axis Angle、Z-axis Angular Velocity

| RideTrack      |    Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|--------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        | 99.1696 |       58.7719 |      60.6987 |    81.25 |     63.5593 |          51.9126 |            81.4933 |
| Filter_Predict | 99.5255 |       64.9123 |      60.262  |    97.5  |     76.2712 |          64.4809 |            85.3223 |

| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       74 |                22 |                      2 |                      11 |                           5 |                   0 |    64.9123 |
| Idle           |                        0 |               839 |                      0 |                       0 |                           4 |                   0 |    99.5255 |
| Turn Left      |                        9 |                 0 |                     90 |                      12 |                           0 |                   7 |    76.2712 |
| Turn Right     |                       27 |                26 |                      0 |                     138 |                          15 |                  23 |    60.262  |
| Two-Stage Left |                       10 |                35 |                      0 |                      11 |                         118 |                   9 |    64.4809 |
| U-turn         |                        0 |                 2 |                      0 |                       0 |                           0 |                  78 |    97.5    |









#### Case 5-3：隨機森林選擇權重最大的k個特徵
#### 分群模型檔: Ablation2_Case5_RandomForestClassifier_Model.pkl (為了可重置實驗)
#### 選擇特徵: Y-axis Angular Velocity、X-axis Angle、Z-axis Angular Velocity





| RideTrack      |   Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|-------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        |    100 |       41.2281 |      82.5328 |    66.25 |     98.3051 |          72.6776 |            88.1302 |
| Filter_Predict |    100 |       45.614  |      87.7729 |    73.75 |    100      |          83.0601 |            90.9381 |

| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       52 |                14 |                      0 |                       0 |                          48 |                   0 |    45.614  |
| Idle           |                        0 |               843 |                      0 |                       0 |                           0 |                   0 |   100      |
| Turn Left      |                        0 |                 0 |                    118 |                       0 |                           0 |                   0 |   100      |
| Turn Right     |                       16 |                 7 |                      0 |                     201 |                           5 |                   0 |    87.7729 |
| Two-Stage Left |                        5 |                26 |                      0 |                       0 |                         152 |                   0 |    83.0601 |
| U-turn         |                        0 |                 2 |                      0 |                       0 |                          19 |                  59 |    73.75   |

















## 4.2.3 特徵工程消融實驗：IMU+ECU

在此階段的實驗中，我們嘗試深入探索並比較三種不同的特徵選擇策略對模型性能的影響。此實驗不僅考慮了來自IMU的資料，還將引擎控制單元 (ECU) 的特徵資料納入考量，提供更完整與全面的數據視角。




### Case 1：使用IMU與ECU並通過PCA降至k個特徵:
在此實驗中，我們將IMU與ECU的數據進行合併，然後利用主成分分析 (PCA) 降維，篩選出k個最主要的特徵。我們也使用隨機森林（Random Forest）的平均劃分減少和平均覆蓋度減少來進行特徵重要性評估，並挑選出最重要的k個特徵。

#### Case 1-1：IMU選3，ECU選7 (K=10)
#### 分群模型檔: Ablation3_Case1_PCA3_ECU7_Model.pkl (為了可重置實驗)
#### 選擇特徵:Z-axis Angular Velocity、X-axis Angle、X-axis Angular Velocity、Fuel Injection Prohibition Mode、ABV Opening、ABV Idling Correction、'Throttle Valve Air Flow、Engine RPM、O2 Voltage、Vehicle Speed'


| RideTrack      |   Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|-------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        |    100 |       41.2281 |      82.5328 |    66.25 |     98.3051 |          72.6776 |            88.1302 |
| Filter_Predict |    100 |       45.614  |      87.7729 |    73.75 |    100      |          83.0601 |            90.9381 |


| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       52 |                14 |                      0 |                       0 |                          48 |                   0 |    45.614  |
| Idle           |                        0 |               843 |                      0 |                       0 |                           0 |                   0 |   100      |
| Turn Left      |                        0 |                 0 |                    118 |                       0 |                           0 |                   0 |   100      |
| Turn Right     |                       16 |                 7 |                      0 |                     201 |                           5 |                   0 |    87.7729 |
| Two-Stage Left |                        5 |                26 |                      0 |                       0 |                         152 |                   0 |    83.0601 |
| U-turn         |                        0 |                 2 |                      0 |                       0 |                          19 |                  59 |    73.75   |


#### Case 1-2：IMU選6，ECU選4 (K=10)
#### 分群模型檔: Ablation3_Case1_PCA6_ECU4_Model.pkl (為了可重置實驗)
#### 選擇特徵:Engine RPM、Closed Loop Fuel Correction、O2 Voltage、Vehicle Speed、Z-axis Angular Velocity、X-axis Angle、X-axis Angular Velocity、Y-axis Angular Velocity、X-axis Acceleration、Y-axis Angle



| RideTrack      |   Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|-------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
 | Predict        |    100 |       42.1053 |      83.4061 |    66.25 |     97.4576 |          71.5847 |            88.1302 |
| Filter_Predict |    100 |       46.4912 |      89.083  |    73.75 |     97.4576 |          83.0601 |            91.0019 |

| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       53 |                14 |                      0 |                       0 |                          47 |                   0 |    46.4912 |
| Idle           |                        0 |               843 |                      0 |                       0 |                           0 |                   0 |   100      |
| Turn Left      |                        0 |                 0 |                    115 |                       0 |                           0 |                   3 |    97.4576 |
| Turn Right     |                       14 |                 7 |                      0 |                     204 |                           4 |                   0 |    89.083  |
| Two-Stage Left |                        5 |                26 |                      0 |                       0 |                         152 |                   0 |    83.0601 |
| U-turn         |                        0 |                 2 |                      0 |                       0 |                          19 |                  59 |    73.75   |









### Case 2：使用IMU通過PCA降至k個特徵 + 使用ECU通過PCA降至k個特徵:
在此實驗中，我們分別對IMU與ECU的數據進行主成分分析 (PCA) 降維，然後各自篩選出k個最主要的特徵。此外，我們也針對IMU和ECU各自的數據使用隨機森林的平均劃分減少和平均覆蓋度減少方法，分別選出重要性最高的k個特徵。




#### Case 2-1：PCA的來評估特徵的重要性，並選擇權重最大的k個特徵 (K=10)
#### 分群模型檔: Ablation3._Case2_PCA_Model.pkl (為了可重置實驗)
#### 選擇特徵: ABV Opening、Ignition Advance Angle、Air-Fuel Ratio Rich、Throttle Valve Air Flow、O2 Voltage、Ignition Magnetization Time、Engine State、Combustion Chamber Intake Temperature、TPS Opening、TPS Voltage


| RideTrack      |   Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|-------:|--------------:|-------------:|---------:|------------:|-----------------:|------------------|
| Predict        |    100 |       41.2281 |      82.5328 |    66.25 |     98.3051 |          72.6776 |            88.1302 |
| Filter_Predict |    100 |       45.614  |      87.7729 |    73.75 |    100      |          83.0601 |            90.9381 |

| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       52 |                14 |                      0 |                       0 |                          48 |                   0 |    45.614  |
| Idle           |                        0 |               843 |                      0 |                       0 |                           0 |                   0 |   100      |
| Turn Left      |                        0 |                 0 |                    118 |                       0 |                           0 |                   0 |   100      |
| Turn Right     |                       16 |                 7 |                      0 |                     201 |                           5 |                   0 |    87.7729 |
| Two-Stage Left |                        5 |                26 |                      0 |                       0 |                         152 |                   0 |    83.0601 |
| U-turn         |                        0 |                 2 |                      0 |                       0 |                          19 |                  59 |    73.75   |




#### Case 2-2：隨機森林選擇權重最大的k個特徵
#### 分群模型檔: Ablation23_Case2_RandomForestClassifier_Model.pkl (為了可重置實驗)
#### 選擇特徵: Ignition Coil Current Diagnosis、Engine RPM、Ignition Magnetization Time、Closed Loop Fuel Correction、O2 Voltage、Vehicle Speed、X-axis Angular Velocity、Y-axis Angular Velocity、Z-axis Angular Velocity、X-axis Angle


| RideTrack      |   Idle |   Go Straight |   Turn Right |   U-turn |   Turn Left |   Two-Stage Left |   Accuracy (Total) |
|:---------------|-------:|--------------:|-------------:|---------:|------------:|-----------------:|-------------------:|
| Predict        |    100 |       41.2281 |      82.5328 |    66.25 |     98.3051 |          72.6776 |            88.1302 |
| Filter_Predict |    100 |       45.614  |      87.7729 |    73.75 |    100      |          83.0601 |            90.9381 |

| Action         |   Predicted: Go Straight |   Predicted: Idle |   Predicted: Turn Left |   Predicted: Turn Right |   Predicted: Two-Stage Left |   Predicted: U-turn |   Accuracy |
|:---------------|-------------------------:|------------------:|-----------------------:|------------------------:|----------------------------:|--------------------:|-----------:|
| Go Straight    |                       52 |                14 |                      0 |                       0 |                          48 |                   0 |    45.614  |
| Idle           |                        0 |               843 |                      0 |                       0 |                           0 |                   0 |   100      |
| Turn Left      |                        0 |                 0 |                    118 |                       0 |                           0 |                   0 |   100      |
| Turn Right     |                       16 |                 7 |                      0 |                     201 |                           5 |                   0 |    87.7729 |
| Two-Stage Left |                        5 |                26 |                      0 |                       0 |                         152 |                   0 |    83.0601 |
| U-turn         |                        0 |                 2 |                      0 |                       0 |                          19 |                  59 |    73.75   |











實驗結果分析:

在完成以上各階段的實驗後，我們將深入研究各種預處理和特徵選擇策略對模型性能的影響。我們將比較每種策略的實驗結果，從中找出對模型預測準確度提升幅度最大的策略。這將有助於我們在實際應用中，有效地提升模型的性能並優化預測結果。



